name: C/C++ CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:

    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v2
    - name: move wrapper
      run: mv fastText fastText2
    - uses: actions/checkout@master
      with:
        name: facebookresearch/fastText
        ref: refs/heads/release
    - name: make facebook fasttext
      run: cd fastText && ls && make && mv -v ./lib/* ../fastText2/lib && mv -v ./obj/* ../fastText2/obj &&  rm -r fastText
    - name: cd to fasttext wrapper
      run: cd fastText2 && ls && make && cd .. && zip -r complete.zip fastText2 && rm -r fastText2
    - name: Create Release
      id: create_release
      uses: zendesk/action-create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    - uses: xresloader/upload-to-github-release@master
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        file: "*.zip"
        tags: true
        draft: false
        branches: "master;dev"
        verbose: true
      

